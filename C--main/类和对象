#pragma once
#include <string>
class stock {
private:
	std::string company;
	int shares;
	double share_val;
	double total_val;
	void set_tot() { total_val = shares * share_val; };
public:
	stock();
	stock(const std::string& co, long n = 0, double pr = 0.0);
	~stock();
	void buy(long num, double price);
	void sell(long num, double price);
	void update(double price);
	void show()const;
	const stock& topval(const stock& s)const;
};
//头文件

#include <iostream>
#include "stock20.h"
stock::stock()
{
	company = "no name";
	shares = 0;
	share_val = 0.0;
	total_val = 0.0;
}


stock::stock(const std::string& co, long n, double pr) {
	company = co;
	if (n < 0) {
		std::cout << "numer of shares can not be negative"
			<< company << "shares set to 0.\n";
		shares = 0;
	}
	else shares = n;
	share_val = pr;
	set_tot();

}

stock::~stock() {

}

//other methods
void stock::buy(long num, double price) {
	if (num < 0) {
		std::cout << "Number of shares purchased can not be negative" << "transaction is aborted\n";
	}
	else {
		shares += num;
		share_val = price;
		set_tot();
	}

}

void stock::sell(long num, double price) {
	using std::cout;
	if (num < 0) {
		cout << "Number of shares sold can not be negative"
			<< "transaction is aborted.\n";
	}
	else {
		shares -= num;
		share_val = price;
		set_tot();
	}
}

void stock::update(double price) {
	share_val = price;
	set_tot();
}

void stock::show()const {
	using std::cout;
	using std::ios_base;
	//set format to#.###
	ios_base::fmtflags orig =
		cout.setf(ios_base::fixed, ios_base::floatfield);
	std::streamsize prec = cout.precision(3);

	cout << "company :" << company
		<< "shares:" << shares << "\n";
	cout << "shares price:$" << share_val << "\n";
	//set format to #.##
	cout.precision(2);
	cout << "total worth :$" << total_val << "\n";
	//restore originao format
	cout.setf(orig, ios_base::floatfield);
	cout.precision(prec);
}

const stock& stock::topval(const stock& s)const
{
	if (s.total_val > 0)
		return s;
	else return *this;
}

//源文件1
#include <iostream>
#include "stock20.h"
const int stks = 4;
int main() {
	//create an array of initial objects
	stock stocks[stks] = {
		stock("nanosmart",12,20.0),
		stock("boffo objects",200,2.0),
		stock("monola ibelistd",130,3.25),
		stock("fleep enterproce",60,6.5)
	};

	std::cout << "stovk holdings:\n";
	int st;
	for (st = 0; st < stks; st++)
	stocks[st].show();

		//set pointer to first element
		const stock* top = &stocks[0];
		for (st = 1; st < stks; st++)
			top = &top->topval(stocks[st]);   //函数的返回值是一个对象
		 //now top points to the most valuable holdins
		std::cout << "\nmost valuble holdins :\n";
		top->show();
		return 0;
	
}
//源文件2


























